<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jorge García Acedo y Alejandro García Gómez">
<meta name="dcterms.date" content="2026-02-02">

<title>Análisis del abandono estudiantil</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Practica_files/libs/clipboard/clipboard.min.js"></script>
<script src="Practica_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Practica_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Practica_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="Practica_files/libs/quarto-html/popper.min.js"></script>
<script src="Practica_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Practica_files/libs/quarto-html/anchor.min.js"></script>
<link href="Practica_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Practica_files/libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Practica_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Practica_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Practica_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introducción-y-carga-de-datos" id="toc-introducción-y-carga-de-datos" class="nav-link active" data-scroll-target="#introducción-y-carga-de-datos"><span class="header-section-number">1</span> Introducción y carga de datos:</a>
  <ul>
  <li><a href="#variables-del-dataset" id="toc-variables-del-dataset" class="nav-link" data-scroll-target="#variables-del-dataset"><span class="header-section-number">1.1</span> Variables del dataset</a></li>
  <li><a href="#división-del-conjunto-de-datos" id="toc-división-del-conjunto-de-datos" class="nav-link" data-scroll-target="#división-del-conjunto-de-datos"><span class="header-section-number">1.2</span> División del conjunto de datos</a></li>
  <li><a href="#análisis-exploratorio-de-datos-eda" id="toc-análisis-exploratorio-de-datos-eda" class="nav-link" data-scroll-target="#análisis-exploratorio-de-datos-eda"><span class="header-section-number">1.3</span> Análisis exploratorio de datos (EDA)</a></li>
  <li><a href="#matrices-de-distancias-para-variables-categóricas" id="toc-matrices-de-distancias-para-variables-categóricas" class="nav-link" data-scroll-target="#matrices-de-distancias-para-variables-categóricas"><span class="header-section-number">1.4</span> Matrices de distancias para variables categóricas</a>
  <ul>
  <li><a href="#estado-civil" id="toc-estado-civil" class="nav-link" data-scroll-target="#estado-civil"><span class="header-section-number">1.4.1</span> Estado civil</a></li>
  <li><a href="#grados" id="toc-grados" class="nav-link" data-scroll-target="#grados"><span class="header-section-number">1.4.2</span> Grados</a></li>
  <li><a href="#cualificacion-previa" id="toc-cualificacion-previa" class="nav-link" data-scroll-target="#cualificacion-previa"><span class="header-section-number">1.4.3</span> Cualificacion previa</a></li>
  <li><a href="#ocupación-de-los-padres-y-previa-de-los-estudiantes" id="toc-ocupación-de-los-padres-y-previa-de-los-estudiantes" class="nav-link" data-scroll-target="#ocupación-de-los-padres-y-previa-de-los-estudiantes"><span class="header-section-number">1.4.4</span> Ocupación de los padres y previa de los estudiantes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#reducción-de-dimensionalidad" id="toc-reducción-de-dimensionalidad" class="nav-link" data-scroll-target="#reducción-de-dimensionalidad"><span class="header-section-number">2</span> Reducción de dimensionalidad:</a>
  <ul>
  <li><a href="#análisis-de-componentes-principales-pca" id="toc-análisis-de-componentes-principales-pca" class="nav-link" data-scroll-target="#análisis-de-componentes-principales-pca"><span class="header-section-number">2.1</span> Análisis de componentes principales (PCA)</a></li>
  <li><a href="#outliers-con-las-variables-del-pca" id="toc-outliers-con-las-variables-del-pca" class="nav-link" data-scroll-target="#outliers-con-las-variables-del-pca"><span class="header-section-number">2.2</span> Outliers con las variables del PCA</a></li>
  </ul></li>
  <li><a href="#clustering-con-k-means" id="toc-clustering-con-k-means" class="nav-link" data-scroll-target="#clustering-con-k-means"><span class="header-section-number">3</span> Clustering con K-means</a>
  <ul>
  <li><a href="#con-las-variables-originales" id="toc-con-las-variables-originales" class="nav-link" data-scroll-target="#con-las-variables-originales"><span class="header-section-number">3.1</span> Con las variables originales</a></li>
  </ul></li>
  <li><a href="#construcción-y-validación-de-modelos" id="toc-construcción-y-validación-de-modelos" class="nav-link" data-scroll-target="#construcción-y-validación-de-modelos"><span class="header-section-number">4</span> Construcción y validación de modelos</a>
  <ul>
  <li><a href="#validación-del-modelo-k-means" id="toc-validación-del-modelo-k-means" class="nav-link" data-scroll-target="#validación-del-modelo-k-means"><span class="header-section-number">4.1</span> Validación del modelo K-means</a></li>
  <li><a href="#knn-k-nearest-neighbours" id="toc-knn-k-nearest-neighbours" class="nav-link" data-scroll-target="#knn-k-nearest-neighbours"><span class="header-section-number">4.2</span> Knn (K nearest neighbours)</a></li>
  <li><a href="#árboles-de-decisión" id="toc-árboles-de-decisión" class="nav-link" data-scroll-target="#árboles-de-decisión"><span class="header-section-number">4.3</span> Árboles de decisión</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="header-section-number">4.4</span> Random forest</a></li>
  <li><a href="#conclusiones" id="toc-conclusiones" class="nav-link" data-scroll-target="#conclusiones"><span class="header-section-number">4.5</span> Conclusiones</a></li>
  <li><a href="#simplificación-del-modelo-random-forest." id="toc-simplificación-del-modelo-random-forest." class="nav-link" data-scroll-target="#simplificación-del-modelo-random-forest."><span class="header-section-number">4.6</span> Simplificación del modelo random forest.</a></li>
  </ul></li>
  <li><a href="#testing-final" id="toc-testing-final" class="nav-link" data-scroll-target="#testing-final"><span class="header-section-number">5</span> Testing final</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Análisis del abandono estudiantil</h1>
<p class="subtitle lead">Grado en Matemáticas | Minería de datos</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jorge García Acedo y Alejandro García Gómez </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 2, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<style type="text/css">
p {
  text-align: justify
}
</style>
</div>
<section id="introducción-y-carga-de-datos" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción y carga de datos:</h1>
<p>Este proyecto aborda el análisis de datos académicos de estudiantes universitarios en Portugal con el objetivo de predecir su resultado académico <strong>finalización de los estudios, titulación tardía o abandono</strong> mediante técnicas de análisis de datos y modelización predictiva,implementadas en R, a partir de un conjunto de datos real procedente del repositorio <a href="https://archive.ics.uci.edu/dataset/697/predict+students+dropout+and+academic+success">UC Irvine Machine Learning Repository</a>. Para ello emplearemos las siguientes librerías:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cargamos las librerías necesarias</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NbClust)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)     </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)    </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cargamos los datos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data.csv"</span>, <span class="at">sep=</span><span class="st">";"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4424   37</code></pre>
</div>
</div>
<p>Observamos que hay 4424 registros y 37 variables. Las variables son las siguientes:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Marital.status"                                
 [2] "Application.mode"                              
 [3] "Application.order"                             
 [4] "Course"                                        
 [5] "Daytime.evening.attendance."                   
 [6] "Previous.qualification"                        
 [7] "Previous.qualification..grade."                
 [8] "Nacionality"                                   
 [9] "Mother.s.qualification"                        
[10] "Father.s.qualification"                        
[11] "Mother.s.occupation"                           
[12] "Father.s.occupation"                           
[13] "Admission.grade"                               
[14] "Displaced"                                     
[15] "Educational.special.needs"                     
[16] "Debtor"                                        
[17] "Tuition.fees.up.to.date"                       
[18] "Gender"                                        
[19] "Scholarship.holder"                            
[20] "Age.at.enrollment"                             
[21] "International"                                 
[22] "Curricular.units.1st.sem..credited."           
[23] "Curricular.units.1st.sem..enrolled."           
[24] "Curricular.units.1st.sem..evaluations."        
[25] "Curricular.units.1st.sem..approved."           
[26] "Curricular.units.1st.sem..grade."              
[27] "Curricular.units.1st.sem..without.evaluations."
[28] "Curricular.units.2nd.sem..credited."           
[29] "Curricular.units.2nd.sem..enrolled."           
[30] "Curricular.units.2nd.sem..evaluations."        
[31] "Curricular.units.2nd.sem..approved."           
[32] "Curricular.units.2nd.sem..grade."              
[33] "Curricular.units.2nd.sem..without.evaluations."
[34] "Unemployment.rate"                             
[35] "Inflation.rate"                                
[36] "GDP"                                           
[37] "Target"                                        </code></pre>
</div>
</div>
<section id="variables-del-dataset" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="variables-del-dataset"><span class="header-section-number">1.1</span> Variables del dataset</h2>
<p>A continuación se describen las variables incluidas en el conjunto de datos de estudiantes universitarios:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 37%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Nº</th>
<th>Variable</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><strong>Marital.status</strong></td>
<td>Estado civil del estudiante (soltero, casado, divorciado, etc.).</td>
</tr>
<tr class="even">
<td>2</td>
<td><strong>Application.mode</strong></td>
<td>Modo o vía de acceso a la universidad (por ejemplo, examen nacional, transferencia, etc.).</td>
</tr>
<tr class="odd">
<td>3</td>
<td><strong>Application.order</strong></td>
<td>Orden de preferencia de la carrera elegida en la solicitud de ingreso.</td>
</tr>
<tr class="even">
<td>4</td>
<td><strong>Course</strong></td>
<td>Carrera o titulación en la que el estudiante está matriculado.</td>
</tr>
<tr class="odd">
<td>5</td>
<td><strong>Daytime.evening.attendance.</strong></td>
<td>Tipo de asistencia: si el alumno cursa estudios diurnos o vespertinos.</td>
</tr>
<tr class="even">
<td>6</td>
<td><strong>Previous.qualification</strong></td>
<td>Nivel educativo más alto alcanzado antes de ingresar (por ejemplo, secundaria, formación profesional, etc.).</td>
</tr>
<tr class="odd">
<td>7</td>
<td><strong>Previous.qualification..grade.</strong></td>
<td>Calificación obtenida en la titulación previa.</td>
</tr>
<tr class="even">
<td>8</td>
<td><strong>Nacionality</strong></td>
<td>Nacionalidad del estudiante.</td>
</tr>
<tr class="odd">
<td>9</td>
<td><strong>Mother.s.qualification</strong></td>
<td>Nivel educativo alcanzado por la madre.</td>
</tr>
<tr class="even">
<td>10</td>
<td><strong>Father.s.qualification</strong></td>
<td>Nivel educativo alcanzado por el padre.</td>
</tr>
<tr class="odd">
<td>11</td>
<td><strong>Mother.s.occupation</strong></td>
<td>Ocupación principal de la madre.</td>
</tr>
<tr class="even">
<td>12</td>
<td><strong>Father.s.occupation</strong></td>
<td>Ocupación principal del padre.</td>
</tr>
<tr class="odd">
<td>13</td>
<td><strong>Admission.grade</strong></td>
<td>Nota de admisión del estudiante al ingresar a la universidad.</td>
</tr>
<tr class="even">
<td>14</td>
<td><strong>Displaced</strong></td>
<td>Indica si el estudiante vive fuera de su residencia habitual para estudiar.</td>
</tr>
<tr class="odd">
<td>15</td>
<td><strong>Educational.special.needs</strong></td>
<td>Indica si el estudiante presenta necesidades educativas especiales.</td>
</tr>
<tr class="even">
<td>16</td>
<td><strong>Debtor</strong></td>
<td>Indica si el estudiante tiene pagos pendientes con la institución.</td>
</tr>
<tr class="odd">
<td>17</td>
<td><strong>Tuition.fees.up.to.date</strong></td>
<td>Indica si el estudiante tiene las tasas de matrícula al día.</td>
</tr>
<tr class="even">
<td>18</td>
<td><strong>Gender</strong></td>
<td>Género del estudiante.</td>
</tr>
<tr class="odd">
<td>19</td>
<td><strong>Scholarship.holder</strong></td>
<td>Indica si el estudiante es beneficiario de una beca.</td>
</tr>
<tr class="even">
<td>20</td>
<td><strong>Age.at.enrollment</strong></td>
<td>Edad del estudiante en el momento de la matrícula.</td>
</tr>
<tr class="odd">
<td>21</td>
<td><strong>International</strong></td>
<td>Indica si el estudiante es internacional (extranjero).</td>
</tr>
<tr class="even">
<td>22</td>
<td><strong>Curricular.units.1st.sem..credited.</strong></td>
<td>Número de asignaturas reconocidas (convalidadas) en el primer semestre.</td>
</tr>
<tr class="odd">
<td>23</td>
<td><strong>Curricular.units.1st.sem..enrolled.</strong></td>
<td>Número de asignaturas matriculadas en el primer semestre.</td>
</tr>
<tr class="even">
<td>24</td>
<td><strong>Curricular.units.1st.sem..evaluations.</strong></td>
<td>Número de evaluaciones realizadas en el primer semestre.</td>
</tr>
<tr class="odd">
<td>25</td>
<td><strong>Curricular.units.1st.sem..approved.</strong></td>
<td>Número de asignaturas aprobadas en el primer semestre.</td>
</tr>
<tr class="even">
<td>26</td>
<td><strong>Curricular.units.1st.sem..grade.</strong></td>
<td>Nota media obtenida en el primer semestre.</td>
</tr>
<tr class="odd">
<td>27</td>
<td><strong>Curricular.units.1st.sem..without.evaluations.</strong></td>
<td>Asignaturas del primer semestre sin evaluación.</td>
</tr>
<tr class="even">
<td>28</td>
<td><strong>Curricular.units.2nd.sem..credited.</strong></td>
<td>Número de asignaturas reconocidas (convalidadas) en el segundo semestre.</td>
</tr>
<tr class="odd">
<td>29</td>
<td><strong>Curricular.units.2nd.sem..enrolled.</strong></td>
<td>Número de asignaturas matriculadas en el segundo semestre.</td>
</tr>
<tr class="even">
<td>30</td>
<td><strong>Curricular.units.2nd.sem..evaluations.</strong></td>
<td>Número de evaluaciones realizadas en el segundo semestre.</td>
</tr>
<tr class="odd">
<td>31</td>
<td><strong>Curricular.units.2nd.sem..approved.</strong></td>
<td>Número de asignaturas aprobadas en el segundo semestre.</td>
</tr>
<tr class="even">
<td>32</td>
<td><strong>Curricular.units.2nd.sem..grade.</strong></td>
<td>Nota media obtenida en el segundo semestre.</td>
</tr>
<tr class="odd">
<td>33</td>
<td><strong>Curricular.units.2nd.sem..without.evaluations.</strong></td>
<td>Asignaturas del segundo semestre sin evaluación.</td>
</tr>
<tr class="even">
<td>34</td>
<td><strong>Unemployment.rate</strong></td>
<td>Tasa de desempleo del país o región durante el periodo académico.</td>
</tr>
<tr class="odd">
<td>35</td>
<td><strong>Inflation.rate</strong></td>
<td>Tasa de inflación correspondiente al periodo académico.</td>
</tr>
<tr class="even">
<td>36</td>
<td><strong>GDP</strong></td>
<td>Producto Interior Bruto (PIB) del país o región.</td>
</tr>
<tr class="odd">
<td>37</td>
<td><strong>Target</strong></td>
<td>Variable objetivo (por ejemplo, indica si el estudiante completó el curso, abandonó, o tuvo éxito académico).</td>
</tr>
</tbody>
</table>
<p>Todas las variables vienen codificadas con valores numéricos que se pueden consultar en la fuente de los datos. Los datos no tienen valores faltantes tal y como se indicaba.</p>
</section>
<section id="división-del-conjunto-de-datos" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="división-del-conjunto-de-datos"><span class="header-section-number">1.2</span> División del conjunto de datos</h2>
<p>Antes de comenzar con el análisis exploratorio, procedemos a separar los datos en en 3 grupos: El 50% los usaremos para entrenar el modelo, el 25% para hacer pruebas y el 25% restante para validarlo al final.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1889</span>) <span class="co"># Para reproducibilidad</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un vector de índices para dividir los datos</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="fu">nrow</span>(data), <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividir los datos en conjuntos de entrenamiento, prueba y validación</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> data[indices <span class="sc">==</span> <span class="dv">2</span>, ]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>validation_data <span class="ot">&lt;-</span> data[indices <span class="sc">==</span> <span class="dv">3</span>, ]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[indices <span class="sc">==</span> <span class="dv">1</span>, ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="análisis-exploratorio-de-datos-eda" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="análisis-exploratorio-de-datos-eda"><span class="header-section-number">1.3</span> Análisis exploratorio de datos (EDA)</h2>
<p>A continuación se realiza un análisis exploratorio de datos (EDA) para comprender mejor la distribución y características de las variables en el conjunto de datos.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Resumen de las edades de los estudiantes</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>edades <span class="ot">&lt;-</span> <span class="fu">summary</span>(data<span class="sc">$</span>Age.at.enrollment)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>edades</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  17.00   19.00   20.00   23.45   25.00   70.00 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Histograma de las edades</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(data<span class="sc">$</span>Age.at.enrollment, <span class="at">main=</span><span class="st">"Histograma de edades"</span>, <span class="at">xlab=</span><span class="st">"Edad"</span>, <span class="at">col=</span><span class="st">"lightblue"</span>, <span class="at">border=</span><span class="st">"black"</span>, <span class="at">breaks=</span><span class="dv">20</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La mayoría de los estudiantes tienen entre 19 y 25 años al comenzar los estudios, con una mediana de 20 años.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla de frecuencias de las nacionalidades</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nacionality <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">factor</span>(data<span class="sc">$</span>Nacionality,<span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">21</span>,<span class="dv">22</span>,<span class="dv">24</span>,<span class="dv">25</span>,<span class="dv">26</span>,<span class="dv">32</span>,<span class="dv">41</span>,<span class="dv">62</span>,<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">103</span>,<span class="dv">105</span>,<span class="dv">108</span>,<span class="dv">109</span>),<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"PT"</span>,<span class="st">"DE"</span>,<span class="st">"ES"</span>,<span class="st">"IT"</span>,<span class="st">"NL"</span>,<span class="st">"EN"</span>,<span class="st">"LT"</span>,<span class="st">"AO"</span>,<span class="st">"CV"</span>,<span class="st">"GN"</span>,<span class="st">"MZ"</span>,<span class="st">"ST"</span>,<span class="st">"TR"</span>,<span class="st">"BR"</span>,<span class="st">"RO"</span>,<span class="st">"MD"</span>,<span class="st">"MX"</span>,<span class="st">"UA"</span>,<span class="st">"RU"</span>,<span class="st">"CU"</span>,<span class="st">"CO"</span>)))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>f_nacionalidades <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">table</span>(data<span class="sc">$</span>Nacionality),<span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>f_nacionalidades <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(f_nacionalidades)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>f_nacionalidades</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   PT    BR    ES    CV    ST    GN    IT    MD    RU    UA    AO    EN    MZ 
97.97  0.64  0.32  0.28  0.18  0.09  0.09  0.09  0.09  0.09  0.05  0.05  0.05 </code></pre>
</div>
</div>
<p>La nacionalidad predominante es portuguesa (<em>PT</em>) con un 97.97% de los estudiantes, seguida por Brasil (<em>BR</em>) con un 0.64%. Dado que la inmensa mayoría de los estudiantes son portugueses, inicialmente no tendremos en cuenta esta variable. En su lugar usaremos una binaria que indica si es internacional o no.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Proporción de género</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Gender_char <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">factor</span>(data<span class="sc">$</span>Gender,<span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Hombre"</span>,<span class="st">"Mujer"</span>)))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>f_genero <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(data<span class="sc">$</span>Gender_char))<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>f_genero</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Hombre  Mujer 
 36.46  63.54 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contingencia entre género y variable objetivo</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>cont_genero <span class="ot">&lt;-</span> <span class="fu">table</span>(data<span class="sc">$</span>Gender_char,data<span class="sc">$</span>Target)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>cont_genero <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(cont_genero,<span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>cont_genero <span class="ot">&lt;-</span> <span class="fu">addmargins</span>(cont_genero)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>cont_genero</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        
         Dropout Enrolled Graduate    Sum
  Hombre   45.33    18.43    36.24 100.00
  Mujer    25.72    17.75    56.52  99.99</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Representamos estos datos en un grafico de barras acumulado</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">t</span>(cont_genero[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]), <span class="at">beside=</span><span class="cn">FALSE</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"lightcoral"</span>,<span class="st">"lightblue"</span>,<span class="st">"lightgreen"</span>), <span class="at">legend =</span> <span class="fu">colnames</span>(cont_genero[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]), <span class="at">main=</span><span class="st">"Distribución de la variable objetivo por género"</span>, <span class="at">xlab=</span><span class="st">"Género"</span>, <span class="at">ylab=</span><span class="st">"Porcentaje"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>En cuanto al género, observamos una mayor presencia de mujeres, representando el 63.54% de los datos. Esto es mayor comparado con los datos publicados por la <a href="https://www.oecd.org/content/dam/oecd/en/publications/reports/2024/09/education-at-a-glance-2024-country-notes_532eb29d/portugal_55fb2ce4/a6ce9dbc-en.pdf"><em>OCDE</em></a> que indican que este porcentaje es el 54%. Esta diferencia se puede explicar por los grados elegidos para nuestros datos que pueden no ser representativos. También podemos observar que más hombres dejan los estudios (45.33%) respecto a las mujeres (25.72%).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Resumen de las notas de entrada</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>Admission.grade)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   95.0   117.5   125.9   126.9   135.0   190.0 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grafico de densidad de las notas de entrada</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> Admission.grade)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="fu">ceiling</span>(<span class="fu">min</span>(data<span class="sc">$</span>Admission.grade)<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>, <span class="fu">max</span>(data<span class="sc">$</span>Admission.grade), <span class="at">by =</span> <span class="dv">10</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Notas de Admisión"</span>, <span class="at">x =</span> <span class="st">"Nota de Admisión"</span>, <span class="at">y =</span> <span class="st">"Densidad"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hacemos un histograma con las calificaciones en intervalos de 10</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> Admission.grade)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histograma de Notas de Admisión"</span>, <span class="at">x =</span> <span class="st">"Nota de Admisión"</span>, <span class="at">y =</span> <span class="st">"Frecuencia"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hacemos el grafico de correlación entre la nota de admisión y la nota obtenida en el primer semestre</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data[data<span class="sc">$</span>Curricular.units<span class="fl">.1</span>st.sem..grade.<span class="sc">&gt;</span><span class="dv">0</span>,],<span class="fu">aes</span>(<span class="at">x=</span>Admission.grade,<span class="at">y=</span>Curricular.units<span class="fl">.1</span>st.sem..grade.))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> lm,<span class="at">color=</span><span class="st">"red"</span>,<span class="at">se =</span> <span class="cn">TRUE</span>)<span class="sc">+</span><span class="fu">stat_cor</span>(<span class="at">method =</span> <span class="st">"pearson"</span>,<span class="at">label.x =</span> <span class="dv">100</span>,<span class="at">label.y =</span> <span class="dv">20</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Respecto a las notas de admisión, podemos ver que las notas tienden a concentrarse en los múltiplos de 10, lo que sugiere una posible influencia de los sistemas de calificación. No existe una fuerte correlación entre la nota de admisión y los resultados obtenidos en el primer semestre, con un coeficiente r=0.33.</p>
</section>
<section id="matrices-de-distancias-para-variables-categóricas" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="matrices-de-distancias-para-variables-categóricas"><span class="header-section-number">1.4</span> Matrices de distancias para variables categóricas</h2>
<p>A continuación se muestran las matrices de distancias diseñadas para las variables categóricas más relevantes del conjunto de datos. Después, realizamos un escalamiento multidimensional, para obtener dos variables numéricas por cada variable categórica de modo que la distancia euclidea en el plano entre dos posibles valores de la variable categórica se corresponde con la distancia establecida en la matriz. Esto nos permite generar un nuevo dataframe donde todas las variables son numericas.</p>
<section id="estado-civil" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="estado-civil"><span class="header-section-number">1.4.1</span> Estado civil</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir los nombres de los estados civiles</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>estados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>), <span class="at">nombre=</span><span class="fu">c</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Soltero"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Casado"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Viudo"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Divorciado"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pareja"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Separado"</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>matriz_datos_estados <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>,  </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>,  </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>,  </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1</span>,  </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>,  </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">0</span>   </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>matriz_distancias_estados <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  matriz_datos_estados,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">6</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(estados<span class="sc">$</span>id, estados<span class="sc">$</span>id)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Escalamiento multidimensional</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>coordenadas_estados <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(matriz_distancias_estados, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coordenadas_estados) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Estado1"</span>, <span class="st">"Estado2"</span>)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(coordenadas_estados) <span class="ot">&lt;-</span> estados<span class="sc">$</span>id</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>estados_numeric <span class="ot">&lt;-</span> coordenadas_estados[data<span class="sc">$</span>Marital.status, ]</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(estados_numeric) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Estado1"</span>,<span class="st">"Estado2"</span>)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Represetamos en el plano las coordenadas de los estados civiles con sus etiquetas</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coordenadas_estados, <span class="fu">aes</span>(<span class="at">x =</span> Estado1, <span class="at">y =</span> Estado2)) <span class="sc">+</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> estados<span class="sc">$</span>nombre), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Dimensión 1"</span>) <span class="sc">+</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Dimensión 2"</span>) <span class="sc">+</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Escalamiento Multidimensional de Estados Civiles"</span>) <span class="sc">+</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="grados" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="grados"><span class="header-section-number">1.4.2</span> Grados</h3>
<p>El criterio general utilizado para asignar las distancias entre los grados fue la similitud en el campo de estudio principal y la orientación profesional/académica. Se asignó una distancia de 1 (máxima similitud) a aquellos grados que, o bien son idénticos (salvo por la modalidad de asistencia), o pertenecen a la misma área (ej. dos ingenierías, dos grados de salud, dos diseños visuales). Se asignó distancias mayores (hasta 4) a medida que los grados provienen de campos completamente dispares (ej. Salud versus Ingeniería, o Agricultura versus Animación).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir los nombres de los grados con su ID</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>grados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">33</span>, <span class="dv">171</span>, <span class="dv">8014</span>, <span class="dv">9003</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9070</span>, <span class="dv">9085</span>, <span class="dv">9119</span>, <span class="dv">9130</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9147</span>, <span class="dv">9238</span>, <span class="dv">9254</span>, <span class="dv">9500</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9556</span>, <span class="dv">9670</span>, <span class="dv">9773</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9853</span>, <span class="dv">9991</span>), <span class="at">nombre =</span> <span class="fu">c</span>(<span class="st">"Biofuel Production Technologies"</span>, <span class="st">"Animation and Multimedia Design"</span>, <span class="st">"Social Service (evening attendance)"</span>, <span class="st">"Agronomy"</span>, <span class="st">"Communication Design"</span>, <span class="st">"Veterinary Nursing"</span>, <span class="st">"Informatics Engineering"</span>, <span class="st">"Equinculture"</span>,  <span class="st">"Management"</span>, <span class="st">"Social Service"</span>, <span class="st">"Tourism"</span>, <span class="st">"Nursing"</span>, <span class="st">"Oral Hygiene"</span>, <span class="st">"Advertising and Marketing Management"</span>, <span class="st">"Journalism and Communication"</span>, <span class="st">"Basic Education"</span>, <span class="st">"Management (evening attendance)"</span>))</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir la matriz de distancias entre los grados</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>matriz_datos_grados <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">3</span>, </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, </span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, </span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>, </span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">3</span>, </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">0</span>  </span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear la matriz en R</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>matriz_distancias_grados <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  matriz_datos_grados,</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">17</span>,</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(grados<span class="sc">$</span>id, grados<span class="sc">$</span>id)</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Escalamiento multidimensional</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>coordenadas_grados <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(matriz_distancias_grados, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coordenadas_grados) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Grados1"</span>, <span class="st">"Grados2"</span>)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(coordenadas_grados) <span class="ot">&lt;-</span> grados<span class="sc">$</span>id</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>grados_numeric <span class="ot">&lt;-</span> coordenadas_grados[<span class="fu">as.factor</span>(data<span class="sc">$</span>Course), ]</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(grados_numeric)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Grados1"</span>,<span class="st">"Grados2"</span>)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Represetamos en el plano las coordenadas de los grados con sus etiquetas</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coordenadas_grados, <span class="fu">aes</span>(<span class="at">x =</span> Grados1, <span class="at">y =</span> Grados2)) <span class="sc">+</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> grados<span class="sc">$</span>nombre), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Dimensión 1"</span>) <span class="sc">+</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Dimensión 2"</span>) <span class="sc">+</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Escalamiento Multidimensional de Grados"</span>) <span class="sc">+</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cualificacion-previa" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="cualificacion-previa"><span class="header-section-number">1.4.3</span> Cualificacion previa</h3>
<p>La matriz de distancias para el análisis se generó basándose en la asignación de cada calificación a un <strong>Nivel Educativo ID</strong> (0 a 8 para niveles válidos).</p>
<p>El criterio de distancia es proporcional a la diferencia absoluta entre sus IDs de Nivel, pero se encuentra <strong>limitada a un máximo de 5</strong>.</p>
<p><span class="math display">\[D_{ij} = \min(|\text{ID}_i - \text{ID}_j|, 7)\]</span></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Código(s)</th>
<th style="text-align: left;">Calificación (Resumen)</th>
<th style="text-align: left;">Grado de Educación Aprox.</th>
<th style="text-align: center;">Nivel Educativo ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>35, 36</strong></td>
<td style="text-align: left;">No Lee/Escribe</td>
<td style="text-align: left;">Analfabeto/Preescolar</td>
<td style="text-align: center;"><strong>0</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>37</strong></td>
<td style="text-align: left;">Básica 1er Ciclo (4º/5º)</td>
<td style="text-align: left;">Primaria Incompleta</td>
<td style="text-align: center;"><strong>1</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>11, 26, 38, 30, 29</strong></td>
<td style="text-align: left;">Secundaria Baja Incompleta (7º-9º Incomp.)</td>
<td style="text-align: left;">E.S.O. Incompleta</td>
<td style="text-align: center;"><strong>2</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>19, 10, 12, 14, 27, 9, 15</strong></td>
<td style="text-align: left;">Secundaria Media Incompleta (10º-12º Incomp.)</td>
<td style="text-align: left;">Bachillerato Incompleto</td>
<td style="text-align: center;"><strong>3</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>1, 18, 22, 13, 20, 25</strong></td>
<td style="text-align: left;">Secundaria Completa (12º Año, Cursos Técnicos)</td>
<td style="text-align: left;">Bachillerato/Secundaria Completa</td>
<td style="text-align: center;"><strong>4</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>42, 39, 31, 33</strong></td>
<td style="text-align: left;">Superior Técnica/Post-Secundaria</td>
<td style="text-align: left;">Formación Profesional Superior/Técnico</td>
<td style="text-align: center;"><strong>5</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>2, 3, 40, 41</strong></td>
<td style="text-align: left;">Superior (Grado, Licenciatura, 1er Ciclo)</td>
<td style="text-align: left;">Grado Universitario</td>
<td style="text-align: center;"><strong>6</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>4, 43</strong></td>
<td style="text-align: left;">Superior (Máster, 2º Ciclo)</td>
<td style="text-align: left;">Posgrado (Máster)</td>
<td style="text-align: center;"><strong>7</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>5, 44</strong></td>
<td style="text-align: left;">Superior (Doctorado, 3er Ciclo)</td>
<td style="text-align: left;">Posgrado (Doctorado)</td>
<td style="text-align: center;"><strong>8</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>6, 34</strong></td>
<td style="text-align: left;">Frecuencia Superior, Desconocido</td>
<td style="text-align: left;">Nivel Especial o Indefinido</td>
<td style="text-align: center;"><strong>9 (Especial)</strong></td>
</tr>
</tbody>
</table>
<p>Para el escalado multidimensional, elegiremos tres dimensiones (k=3) para capturar mejor las diferencias entre las cualificaciones.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Procesar el string para crear un data frame</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Cualif_raw <span class="ot">=</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1 - Secondary Education - 12th Year of Schooling or Eq. </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="st">  2 - Higher Education - Bachelor's Degree </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="st">  3 - Higher Education - Degree </span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="st">  4 - Higher Education - Master's </span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="st">  5 - Higher Education - Doctorate </span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="st">  6 - Frequency of Higher Education </span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="st">  9 - 12th Year of Schooling - Not Completed </span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="st">  10 - 11th Year of Schooling - Not Completed </span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="st">  11 - 7th Year (Old) </span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="st">  12 - Other - 11th Year of Schooling </span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="st">  13 - 2nd year complementary high school course </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="st">  14 - 10th Year of Schooling </span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="st">  15 - 10th year of schooling - not completed </span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="st">  18 - General commerce course </span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="st">  19 - Basic Education 3rd Cycle (9th/10th/11th Year) or Equiv. </span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="st">  20 - Complementary High School Course </span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="st">  22 - Technical-professional course </span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="st">  25 - Complementary High School Course - not concluded </span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="st">  26 - 7th year of schooling </span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="st">  27 - 2nd cycle of the general high school course </span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="st">  29 - 9th Year of Schooling - Not Completed </span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="st">  30 - 8th year of schooling </span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="st">  31 - General Course of Administration and Commerce </span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="st">  33 - Supplementary Accounting and Administration </span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="st">  34 - Unknown </span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="st">  35 - Can't read or write </span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="st">  36 - Can read without having a 4th year of schooling </span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="st">  37 - Basic education 1st cycle (4th/5th year) or equiv. </span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="st">  38 - Basic Education 2nd Cycle (6th/7th/8th Year) or Equiv. </span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="st">  39 - Technological specialization course </span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="st">  40 - Higher education - degree (1st cycle) </span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="st">  41 - Specialized higher studies course </span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="st">  42 - Professional higher technical course </span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="st">  43 - Higher Education - Master (2nd cycle) </span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="st">  44 - Higher Education - Doctorate (3rd cycle)"</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>cualif_lines <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(Cualif_raw, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>cualif_lines <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">" - "</span>,<span class="st">"|"</span>,cualif_lines)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>cualif_lines <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(cualif_lines, <span class="st">"|"</span>,<span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>cualificaciones <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">data.frame</span>(cualif_lines)))</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cualificaciones) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"Cualificación"</span>)</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cualificaciones) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>cualificaciones<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">trimws</span>(cualificaciones<span class="sc">$</span>ID))</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar niveles educativos a cada código de cualificación</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>cualificaciones<span class="sc">$</span>Nivel <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>)</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Inicializar la matriz de distancias</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>matriz_distancias_cualif <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(cualificaciones<span class="sc">$</span>ID) , <span class="at">ncol =</span> <span class="fu">length</span>(cualificaciones<span class="sc">$</span>ID), <span class="at">dimnames =</span> <span class="fu">list</span>(cualificaciones<span class="sc">$</span>ID, cualificaciones<span class="sc">$</span>ID))</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cualificaciones<span class="sc">$</span>ID))) {</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cualificaciones<span class="sc">$</span>ID))) {</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    distancia <span class="ot">&lt;-</span> <span class="fu">abs</span>(cualificaciones<span class="sc">$</span>Nivel[i] <span class="sc">-</span> cualificaciones<span class="sc">$</span>Nivel[j])</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    matriz_distancias_cualif[i, j] <span class="ot">&lt;-</span> <span class="fu">min</span>(distancia, <span class="dv">7</span>)</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Escalamiento multidimensional con k=3</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>coordenadas_cualif <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(matriz_distancias_cualif, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(coordenadas_cualif)<span class="ot">&lt;-</span> cualificaciones<span class="sc">$</span>ID</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar las nuevas variables numéricas a las cualificaciones previas de estudiantes y padres</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>cualif_estudiante_numeric <span class="ot">&lt;-</span> coordenadas_cualif[<span class="fu">as.factor</span>(data<span class="sc">$</span>Previous.qualification), ]</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cualif_estudiante_numeric)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"CualifE1"</span>,<span class="st">"CualifE2"</span>,<span class="st">"CualifE3"</span>)</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>cualif_padre_numeric <span class="ot">&lt;-</span> coordenadas_cualif[<span class="fu">as.factor</span>(data<span class="sc">$</span>Father.s.qualification), ]</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cualif_padre_numeric)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"CualifP1"</span>,<span class="st">"CualifP2"</span>,<span class="st">"CualifP3"</span>)</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>cualif_madre_numeric <span class="ot">&lt;-</span> coordenadas_cualif[<span class="fu">as.factor</span>(data<span class="sc">$</span>Mother.s.qualification), ]</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cualif_madre_numeric)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"CualifM1"</span>,<span class="st">"CualifM2"</span>,<span class="st">"CualifM3"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="ocupación-de-los-padres-y-previa-de-los-estudiantes" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="ocupación-de-los-padres-y-previa-de-los-estudiantes"><span class="header-section-number">1.4.4</span> Ocupación de los padres y previa de los estudiantes</h3>
<p>La matriz de distancias se genera asignando a cada ocupación un <strong>Nivel Ocupacional</strong> de 1 a 9, basado en la complejidad y cualificación requerida. Las ocupaciones especiales (0, 10, 90, 99) son excluidas del cálculo de distancia.</p>
<p>El criterio de distancia es la diferencia absoluta entre sus OcupIDs, limitada a un máximo de <strong>5</strong>.</p>
<p><span class="math display">\[D_{ij} = \min(|\text{OcupID}_i - \text{OcupID}_j|, 5)\]</span></p>
<p>Esta tabla resume la clasificación jerárquica utilizada para establecer los Niveless:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Código(s)</th>
<th style="text-align: left;">Ocupación (Resumen)</th>
<th style="text-align: left;">Nivel de Complejidad</th>
<th style="text-align: center;">Nivel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>1, 112, 114</strong></td>
<td style="text-align: left;">Representantes del Poder Legislativo y Ejecutivo, Directores, Gerentes y Ejecutivos</td>
<td style="text-align: left;">Alta Dirección y Gestión</td>
<td style="text-align: center;"><strong>1</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>2, 121, 122, 123, 124, 125</strong></td>
<td style="text-align: left;">Especialistas en Actividades Intelectuales y Científicas</td>
<td style="text-align: left;">Profesiones Científicas y Académicas</td>
<td style="text-align: center;"><strong>2</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>3, 131, 132, 134, 135</strong></td>
<td style="text-align: left;">Técnicos y Profesionales de Nivel Intermedio</td>
<td style="text-align: left;">Nivel Técnico Especializado</td>
<td style="text-align: center;"><strong>3</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>4, 141, 143, 144</strong></td>
<td style="text-align: left;">Personal Administrativo (Oficina, Secretarías, Contabilidad)</td>
<td style="text-align: left;">Soporte Administrativo</td>
<td style="text-align: center;"><strong>4</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>5, 151, 152, 153, 154, 195</strong></td>
<td style="text-align: left;">Servicios Personales, Vendedores, Protección y Seguridad</td>
<td style="text-align: left;">Servicios y Ventas (No cualificado a intermedio)</td>
<td style="text-align: center;"><strong>5</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>6, 161, 163, 192</strong></td>
<td style="text-align: left;">Agricultores y Trabajadores Calificados en Agricultura, Pesca y Silvicultura</td>
<td style="text-align: left;">Trabajo Primario Calificado</td>
<td style="text-align: center;"><strong>6</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>7, 171, 172, 173, 174, 175</strong></td>
<td style="text-align: left;">Trabajadores Calificados en Industria, Construcción y Artesanía</td>
<td style="text-align: left;">Trabajo Industrial y Construcción Calificado</td>
<td style="text-align: center;"><strong>7</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>8, 181, 182, 183</strong></td>
<td style="text-align: left;">Operadores de Instalaciones y Máquinas y Montadores</td>
<td style="text-align: left;">Operadores y Conductores</td>
<td style="text-align: center;"><strong>8</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>9, 191, 193, 194</strong></td>
<td style="text-align: left;">Trabajadores No Cualificados (Limpieza, Ayudantes, etc.)</td>
<td style="text-align: left;">Nivel Básico No Calificado</td>
<td style="text-align: center;"><strong>9</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>0</strong></td>
<td style="text-align: left;">Estudiante</td>
<td style="text-align: left;">Sin Clasificación Laboral</td>
<td style="text-align: center;"><strong>20 (Especial)</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>10, 101, 102, 103</strong></td>
<td style="text-align: left;">Profesiones de las Fuerzas Armadas</td>
<td style="text-align: left;">Ocupación Única/Militar</td>
<td style="text-align: center;"><strong>30 (Especial)</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>90, 99</strong></td>
<td style="text-align: left;">Otra Situación / Vacío</td>
<td style="text-align: left;">Sin Clasificación / Desconocido</td>
<td style="text-align: center;"><strong>99 (Excluido)</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Procesar el string para crear un data frame</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Ocupaciones_raw <span class="ot">=</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">"0   - Student</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="st">      1   - Representatives of the Legislative Power and Executive Bodies, Directors, Directors and Executive Managers</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="st">      2   - Specialists in Intellectual and Scientific Activities</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="st">      3   - Intermediate Level Technicians and Professions</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="st">      4   - Administrative staff</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="st">      5   - Personal Services, Security and Safety Workers and Sellers</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="st">      6   - Farmers and Skilled Workers in Agriculture, Fisheries and Forestry</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="st">      7   - Skilled Workers in Industry, Construction and Craftsmen</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="st">      8   - Installation and Machine Operators and Assembly Workers</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="st">      9   - Unskilled Workers </span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="st">      10  - Armed Forces Professions</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="st">      90  - Other Situation</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="st">      99  - (blank)</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="st">      101 - Armed Forces Officers</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="st">      102 - Armed Forces Sergeants</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="st">      103 - Other Armed Forces personnel</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="st">      112 - Directors of administrative and commercial services</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="st">      114 - Hotel, catering, trade and other services directors</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="st">      121 - Specialists in the physical sciences, mathematics, engineering and related techniques</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="st">      122 - Health professionals</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="st">      123 - Teachers</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="st">      124 - Specialists in finance, accounting, administrative organization, public and commercial relations</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="st">      125 - Specialists in information and communication technologies (ICT)</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="st">      131 - Intermediate level science and engineering technicians and professions</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="st">      132 - Technicians and professionals, of intermediate level of health</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="st">      134 - Intermediate level technicians from legal, social, sports, cultural and similar services</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="st">      135 - Information and communication technology technicians</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="st">      141 - Office workers, secretaries in general and data processing operators</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="st">      143 - Data, accounting, statistical, financial services and registry-related operators</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="st">      144 - Other administrative support staff </span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="st">      151 - personal service workers</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="st">      152 - Sellers</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="st">      153 - Personal care workers and the like</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="st">      154 - Protection and security services personnel</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="st">      161 - Market-oriented farmers and skilled agricultural and animal production workers</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="st">      163 - Farmers, livestock keepers, fishermen, hunters and gatherers, subsistence</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="st">      171 - Skilled construction workers and the like, except electricians</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="st">      172 - Skilled workers in metallurgy, metalworking and similar</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="st">      173 - Skilled workers in printing, precision instrument manufacturing, jewelers, artisans and the like</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="st">      174 - Skilled workers in electricity and electronics</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="st">      175 - Workers in food processing, woodworking, clothing and other industries and crafts</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="st">      181 - Fixed plant and machine operators</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="st">      182 - Assembly workers</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="st">      183 - Vehicle drivers and mobile equipment operators</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="st">      191 - Cleaning workers</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="st">      192 - Unskilled workers in agriculture, animal production, fisheries and forestry </span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="st">      193 - Unskilled workers in extractive industry, construction, manufacturing and transport</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="st">      194 - Meal preparation assistants</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="st">      195 - Street vendors (except food) and street service providers"</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>ocupaciones_lines <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(Ocupaciones_raw, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>ocupaciones_lines <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(ocupaciones_lines, <span class="st">" - "</span>)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>ocupaciones <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">data.frame</span>(ocupaciones_lines)))</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ocupaciones) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"Ocupacion"</span>)</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ocupaciones) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>ocupaciones<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">trimws</span>(ocupaciones<span class="sc">$</span>ID))</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar niveles ocupacionales a cada código de ocupación</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>ocupaciones<span class="sc">$</span>Nivel <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>    <span class="dv">20</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, </span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>    <span class="dv">30</span>, <span class="dv">99</span>, <span class="dv">99</span>, <span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">30</span>, </span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, </span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">7</span>, </span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">5</span></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Inicializar la matriz de distancias</span></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>matriz_distancias_profesiones <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(ocupaciones<span class="sc">$</span>ID) , <span class="at">ncol =</span> <span class="fu">length</span>(ocupaciones<span class="sc">$</span>ID), <span class="at">dimnames =</span> <span class="fu">list</span>(ocupaciones<span class="sc">$</span>ID, ocupaciones<span class="sc">$</span>ID))</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ocupaciones<span class="sc">$</span>ID))) {</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ocupaciones<span class="sc">$</span>ID))) {</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>      distancia <span class="ot">&lt;-</span> <span class="fu">abs</span>(ocupaciones<span class="sc">$</span>Nivel[i] <span class="sc">-</span> ocupaciones<span class="sc">$</span>Nivel[j])</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>      matriz_distancias_profesiones[i, j] <span class="ot">&lt;-</span> <span class="fu">min</span>(distancia, <span class="dv">5</span>)</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Escalamiento multidimensional con k=3</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>coordenadas_profesiones <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(matriz_distancias_profesiones, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coordenadas_profesiones) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Prof1"</span>, <span class="st">"Prof2"</span>, <span class="st">"Prof3"</span>)</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(coordenadas_profesiones) <span class="ot">&lt;-</span> ocupaciones<span class="sc">$</span>ID</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar las nuevas variables numéricas a las ocupaciones de los padres</span></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>prof_madre_numeric <span class="ot">&lt;-</span> coordenadas_profesiones[<span class="fu">as.factor</span>(data<span class="sc">$</span>Mother.s.occupation), ]</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(prof_madre_numeric)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"ProfM1"</span>,<span class="st">"ProfM2"</span>,<span class="st">"ProfM3"</span>)</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>prof_padre_numeric <span class="ot">&lt;-</span> coordenadas_profesiones[<span class="fu">as.factor</span>(data<span class="sc">$</span>Father.s.occupation), ]</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(prof_padre_numeric)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"ProfP1"</span>,<span class="st">"ProfP2"</span>,<span class="st">"ProfP3"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
</section>
<section id="reducción-de-dimensionalidad" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Reducción de dimensionalidad:</h1>
<p>Ya hemos conseguido transformar todas las variables categóricas en numéricas. Ahora podemos crear un nuevo dataframe que contenga todas las variables numéricas para proceder a la reducción de dimensionalidad. De nuestras 36 variables originales (sin contar la objetivo) hemos descartado 9 variables:</p>
<ol type="1">
<li>Nacionalidad (casi todos portugueses). Usamos simplemente la clasificación binaria internacional/no internacional.</li>
<li>Modo de aplicación</li>
<li>Estado civil (categorica)</li>
<li>Grado (categorica)</li>
<li>Cualificaciónes previas del estudiante, padre y madre (son categoricas)</li>
<li>Ocupaciónes del padre y madre (son categoricas)</li>
</ol>
<p>Por tanto tenemos 28 variables numéricas del dataframe original. A estas hemos añadido:</p>
<ul>
<li>2 variables numéricas del estado civil</li>
<li>2 variables numéricas del grado</li>
<li>3 variables numéricas por cada cualificación previa (9 en total)</li>
<li>3 variables numéricas por cada ocupación de los padres (6 en total)</li>
</ul>
<p>En total tenemos <span class="math inline">\(27 + 2 + 2 + 9 + 6 = 46\)</span> variables numéricas. Constriumos un dataframe con todas estas variables:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>datos_numericos<span class="ot">&lt;-</span><span class="fu">data.frame</span>(estados_numeric,data<span class="sc">$</span>Application.order,grados_numeric,data<span class="sc">$</span>Daytime.evening.attendance.,cualif_estudiante_numeric,data<span class="sc">$</span>Previous.qualification..grade.,cualif_madre_numeric,cualif_padre_numeric,prof_madre_numeric,prof_padre_numeric,data[<span class="dv">13</span><span class="sc">:</span><span class="dv">36</span>])</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(datos_numericos) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Vamos a ver la matriz de correlaciones de las variables realacionadas con las notas y la edad:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a> cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">data.frame</span>(data<span class="sc">$</span>Previous.qualification..grade.,data<span class="sc">$</span>Admission.grade,data<span class="sc">$</span>Age.at.enrollment,data<span class="sc">$</span>Curricular.units<span class="fl">.1</span>st.sem..grade.,data<span class="sc">$</span>Curricular.units<span class="fl">.2</span>nd.sem..grade.))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar correlaciones</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="at">tl.srt =</span> <span class="dv">45</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="at">number.cex =</span> <span class="fl">0.7</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Se puede ver que la nota del primer semestre están fuertemente relacionadas con las del segundo.</p>
<section id="análisis-de-componentes-principales-pca" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="análisis-de-componentes-principales-pca"><span class="header-section-number">2.1</span> Análisis de componentes principales (PCA)</h2>
<p>Realizamos un análisis de componentes principales con <code>prcomp</code>. Es importante escalar los datos para que todas las variables tengan la misma importancia en el análisis.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA usando prcomp</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(datos_numericos, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumen</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca_result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1     PC2     PC3     PC4     PC5     PC6     PC7
Standard deviation     2.5062 1.88553 1.83024 1.51429 1.41100 1.33878 1.30223
Proportion of Variance 0.1365 0.07729 0.07282 0.04985 0.04328 0.03896 0.03687
Cumulative Proportion  0.1365 0.21383 0.28665 0.33650 0.37978 0.41874 0.45561
                           PC8     PC9    PC10    PC11    PC12    PC13    PC14
Standard deviation     1.27291 1.22670 1.19298 1.12968 1.11808 1.08805 1.05644
Proportion of Variance 0.03522 0.03271 0.03094 0.02774 0.02718 0.02574 0.02426
Cumulative Proportion  0.49083 0.52354 0.55448 0.58223 0.60940 0.63514 0.65940
                          PC15    PC16    PC17    PC18    PC19    PC20   PC21
Standard deviation     1.02378 1.00570 0.98419 0.97248 0.94997 0.93666 0.9151
Proportion of Variance 0.02279 0.02199 0.02106 0.02056 0.01962 0.01907 0.0182
Cumulative Proportion  0.68219 0.70417 0.72523 0.74579 0.76541 0.78448 0.8027
                          PC22    PC23    PC24    PC25    PC26    PC27    PC28
Standard deviation     0.88591 0.85284 0.80197 0.79025 0.77104 0.75306 0.73897
Proportion of Variance 0.01706 0.01581 0.01398 0.01358 0.01292 0.01233 0.01187
Cumulative Proportion  0.81975 0.83556 0.84954 0.86312 0.87604 0.88837 0.90024
                          PC29    PC30    PC31    PC32    PC33    PC34    PC35
Standard deviation     0.71294 0.69850 0.69457 0.66397 0.63750 0.58572 0.54298
Proportion of Variance 0.01105 0.01061 0.01049 0.00958 0.00884 0.00746 0.00641
Cumulative Proportion  0.91129 0.92190 0.93238 0.94197 0.95080 0.95826 0.96467
                          PC36    PC37    PC38    PC39    PC40    PC41    PC42
Standard deviation     0.51617 0.47317 0.46874 0.42176 0.40331 0.39446 0.38052
Proportion of Variance 0.00579 0.00487 0.00478 0.00387 0.00354 0.00338 0.00315
Cumulative Proportion  0.97046 0.97533 0.98011 0.98397 0.98751 0.99089 0.99404
                          PC43    PC44    PC45    PC46
Standard deviation     0.35380 0.30278 0.19026 0.14541
Proportion of Variance 0.00272 0.00199 0.00079 0.00046
Cumulative Proportion  0.99676 0.99875 0.99954 1.00000</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pca_result,<span class="at">file=</span><span class="st">"pca_result.rds"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar varianza explicada</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pca_result, <span class="at">addlabels =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"Varianza explicada por componente"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_bar(stat = "identity", fill = barfill, color = barcolor, :
Ignoring empty aesthetic: `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visualizar la varianza acumulada dada por data.frame(summary(pca_result)$importance[3,]</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>varianza_acumulada <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Componente =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">summary</span>(pca_result)<span class="sc">$</span>importance[<span class="dv">3</span>,]),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">VarianzaAcumulada =</span> <span class="fu">summary</span>(pca_result)<span class="sc">$</span>importance[<span class="dv">3</span>,])</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(varianza_acumulada, <span class="fu">aes</span>(<span class="at">x =</span> Componente, <span class="at">y =</span> VarianzaAcumulada)) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Varianza Acumulada por Componentes Principales"</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Número de Componentes"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Varianza Acumulada"</span>) <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">21</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"green"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Para cada variable del PCA vemos las variables que contribuyen mas que un umbral (por ejempo 0.1)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(pca_result, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">1</span>, <span class="at">top =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Contribuciones de las variables al PC1"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(pca_result, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">2</span>, <span class="at">top =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Contribuciones de las variables al PC2"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-19-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(pca_result, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">3</span>, <span class="at">top =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Contribuciones de las variables al PC3"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-19-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tomamos las dos primeras componentes principales y representamos las observaciones con colores dependiendo del valor de la variable objetivo</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>pca_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_result<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">Target =</span> data<span class="sc">$</span>Target)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_data, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> Target)) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PCA: Primeras dos Componentes Principales"</span>, <span class="at">x =</span> <span class="st">"Componente Principal 1"</span>, <span class="at">y =</span> <span class="st">"Componente Principal 2"</span>)<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="dv">1</span>)<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-19-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La línea de las gráficas de las contribuciones indica el umbral de contribución media (100% dividido por el número de variables). Las variables que superan esta línea son las que tienen una contribución significativa a la componente principal correspondiente.</p>
</section>
<section id="outliers-con-las-variables-del-pca" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="outliers-con-las-variables-del-pca"><span class="header-section-number">2.2</span> Outliers con las variables del PCA</h2>
<p>Vemos que la primera componentes principal permite una separación inicial aceptable de las clases. Sin embargo, tenemos una serie de datos con un <em>PCA1</em> inusualmente bajo (por debajo de -5). Veamos que ocurre:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pca_outliers <span class="ot">&lt;-</span> data[<span class="fu">rownames</span>(pca_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PC1 <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">5</span>)),]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(pca_outliers)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 93 38</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(pca_outliers<span class="sc">$</span>Course)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 171</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(data[data<span class="sc">$</span>Course<span class="sc">==</span><span class="dv">171</span>,<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 108</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pca_outliers<span class="sc">$</span>Target)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Dropout Enrolled Graduate 
      36       16       41 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>IDS_outliers <span class="ot">&lt;-</span> <span class="fu">rownames</span>(pca_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PC1 <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">5</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(pca_outliers[,<span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">abs</span>(pca_result<span class="sc">$</span>rotation[,<span class="st">"PC1"</span>]), <span class="at">decreasing =</span><span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Curricular.units.1st.sem..approved. Curricular.units.1st.sem..enrolled.
21                                   0                                   0
   Curricular.units.2nd.sem..enrolled. Curricular.units.2nd.sem..approved.
21                                   0                                   0
   Curricular.units.2nd.sem..evaluations.
21                                      0
   Curricular.units.1st.sem..evaluations. Curricular.units.1st.sem..credited.
21                                      0                                   0
   Curricular.units.2nd.sem..credited. Curricular.units.1st.sem..grade.
21                                   0                                0
   Curricular.units.2nd.sem..grade.
21                                0</code></pre>
</div>
</div>
<p>Vemos que estos datos corresponden a 93 de los 108 estudiantes del grado “Animation and Multimedia Design” que no tienen datos academicos propiamente dichos como asignaturas matriculadas o examenes realizados que contribuyen a la primera componenete principal. Los consideraremos outliers, al no tener datos de las variables más determinantes.</p>
</section>
</section>
<section id="clustering-con-k-means" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Clustering con K-means</h1>
<section id="con-las-variables-originales" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="con-las-variables-originales"><span class="header-section-number">3.1</span> Con las variables originales</h2>
<p>En primer lugar vamos a determinar el número óptimo de clusters utilizando el método del codo y el método de la silueta. Debemos escalar primero los datos para que todas las variables tengan el mismo peso.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determinar el número óptimo de clusters</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>datos_numericos_limpios<span class="ot">&lt;-</span>datos_numericos[<span class="sc">!</span><span class="fu">rownames</span>(datos_numericos) <span class="sc">%in%</span> IDS_outliers,]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>datos_scale_limpios<span class="ot">&lt;-</span><span class="fu">scale</span>(datos_numericos_limpios)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>media_limpios <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(datos_numericos_limpios)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>sd_limpios <span class="ot">&lt;-</span> <span class="fu">apply</span>(datos_numericos_limpios, <span class="dv">2</span>, sd)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(datos_scale_limpios,kmeans,<span class="at">method =</span> <span class="st">"wss"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(datos_scale_limpios,kmeans,<span class="at">method =</span> <span class="st">"silhouette"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar K-means con el número óptimo de clusters (por ejemplo, 3)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(datos_scale_limpios[], <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">30</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>data_cluster <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_result<span class="sc">$</span>x[pca_result<span class="sc">$</span>x[,<span class="dv">1</span>]<span class="sc">&gt;=-</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cluster=</span><span class="fu">factor</span>(kmeans_result<span class="sc">$</span>cluster))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>data_sample <span class="ot">&lt;-</span> data_cluster <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cluster)<span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">30</span>,<span class="at">replace=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>sampled_cluster_object <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_sample[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],    <span class="co"># Select only the features (the original data columns)</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> data_sample<span class="sc">$</span>cluster <span class="co"># Select the cluster assignments for the sample</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> sampled_cluster_object,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> sampled_data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="co"># Pass the original features of the sampled data</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">"point"</span>,             <span class="co"># Plot points (you can add "text" if needed)</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ellipse.type =</span> <span class="st">"convex"</span>,      <span class="co"># Adds a normal distribution ellipse</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"fviz_cluster Plot - Sampled (n ="</span>, <span class="dv">20</span> , <span class="st">"per&nbsp;cluster)"</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-21-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar con etiquetas reales</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>tabla_comparacion <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Cluster =</span> kmeans_result<span class="sc">$</span>cluster,<span class="at">objetivo=</span>data[<span class="sc">!</span><span class="fu">rownames</span>(data) <span class="sc">%in%</span> IDS_outliers,]<span class="sc">$</span>Target )</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>tabla_comparacion<span class="ot">&lt;-</span> <span class="fu">addmargins</span>(tabla_comparacion)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>tabla_comparacion[<span class="dv">1</span>,]<span class="ot">&lt;-</span><span class="dv">100</span><span class="sc">*</span>tabla_comparacion[<span class="dv">1</span>,]<span class="sc">/</span>tabla_comparacion[<span class="dv">1</span>,<span class="dv">4</span>]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>tabla_comparacion[<span class="dv">2</span>,]<span class="ot">&lt;-</span><span class="dv">100</span><span class="sc">*</span>tabla_comparacion[<span class="dv">2</span>,]<span class="sc">/</span>tabla_comparacion[<span class="dv">2</span>,<span class="dv">4</span>]</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>tabla_comparacion[<span class="dv">3</span>,]<span class="ot">&lt;-</span><span class="dv">100</span><span class="sc">*</span>tabla_comparacion[<span class="dv">3</span>,]<span class="sc">/</span>tabla_comparacion[<span class="dv">3</span>,<span class="dv">4</span>]</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>tabla_comparacion[<span class="dv">4</span>,]<span class="ot">&lt;-</span><span class="dv">100</span><span class="sc">*</span>tabla_comparacion[<span class="dv">4</span>,]<span class="sc">/</span>tabla_comparacion[<span class="dv">4</span>,<span class="dv">4</span>]</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tabla_comparacion)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       objetivo
Cluster   Dropout  Enrolled  Graduate       Sum
    1    93.08642   6.91358   0.00000 100.00000
    2    24.81203  13.53383  61.65414 100.00000
    3    17.39130  21.34977  61.25892 100.00000
    Sum  32.61183  18.03752  49.35065 100.00000</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>metricas <span class="ot">&lt;-</span> <span class="fu">evaluar_clasificador_binario</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> kmeans_result<span class="sc">$</span>cluster,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> data[<span class="sc">!</span><span class="fu">rownames</span>(data) <span class="sc">%in%</span> IDS_outliers,]<span class="sc">$</span>Target,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_pred =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_pred =</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_real =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_real =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>metricas</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$matriz_confusion
          Predicción
Real       Positivo Negativo  Sum
  Positivo     1373       28 1401
  Negativo      301      377  678
  Sum          1674      405 2079

$metricas
  precision      recall    f1_score    accuracy       error specificity 
  0.8201912   0.9800143   0.8930081   0.8417508   0.1582492   0.5560472 
        npv 
  0.9308642 </code></pre>
</div>
</div>
<p>La matriz de confusión muestra que el modelo clasifica correctamente la mayoría de los positivos reales (1373), lo que se traduce en un <em>recall</em> elevado (0.9800143). La <em>precision</em> es igualmente alta (0.8201912), aunque se observa la presencia de falsos positivos (301). El <em>F1-score</em> (0.8930081) refleja un buen equilibrio entre ambas métricas. No obstante, la capacidad para identificar correctamente la clase negativa es más limitada, como indica la <em>specificity</em> (0.5560472), lo que hace que la <em>accuracy</em> global (0.8417508) sea moderada.</p>
</section>
</section>
<section id="construcción-y-validación-de-modelos" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Construcción y validación de modelos</h1>
<p>Primero necesitamos preparar los datos de prueba o los nuevos para validar y usar el modelo. Necesitamos convertir las variables caregóricas en numéricas usando las mismas transformaciones que para los datos de entrenamiento, además hay que detectar si son outliers. La siguiente función toma un conjunto de datos, los convierte a numéricos y detecta y elimina los outliers avisando previamente.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>es_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x_new, pca_model, <span class="at">umbral =</span> <span class="sc">-</span><span class="dv">5</span>) {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  pc1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca_model, <span class="at">newdata =</span> x_new)[, <span class="dv">1</span>]</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pc1 <span class="sc">&lt;</span> umbral)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>preparar_datos_para_modelo <span class="ot">&lt;-</span> <span class="cf">function</span>(nuevos_datos, resultado_PCA) {</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir variables categóricas a numéricas usando las mismas transformaciones</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  estados_numeric_nuevos <span class="ot">&lt;-</span> coordenadas_estados[nuevos_datos<span class="sc">$</span>Marital.status, ]</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(estados_numeric_nuevos) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Estado1"</span>,<span class="st">"Estado2"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  grados_numeric_nuevos <span class="ot">&lt;-</span> coordenadas_grados[<span class="fu">as.factor</span>(nuevos_datos<span class="sc">$</span>Course), ]</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(grados_numeric_nuevos)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Grados1"</span>,<span class="st">"Grados2"</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  cualif_estudiante_numeric_nuevos <span class="ot">&lt;-</span> coordenadas_cualif[<span class="fu">as.factor</span>(nuevos_datos<span class="sc">$</span>Previous.qualification), ]</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(cualif_estudiante_numeric_nuevos)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"CualifE1"</span>,<span class="st">"CualifE2"</span>,<span class="st">"CualifE3"</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  cualif_padre_numeric_nuevos <span class="ot">&lt;-</span> coordenadas_cualif[<span class="fu">as.factor</span>(nuevos_datos<span class="sc">$</span>Father.s.qualification), ]</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(cualif_padre_numeric_nuevos)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"CualifP1"</span>,<span class="st">"CualifP2"</span>,<span class="st">"CualifP3"</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  cualif_madre_numeric_nuevos <span class="ot">&lt;-</span> coordenadas_cualif[<span class="fu">as.factor</span>(nuevos_datos<span class="sc">$</span>Mother.s.qualification), ]</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(cualif_madre_numeric_nuevos)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"CualifM1"</span>,<span class="st">"CualifM2"</span>,<span class="st">"CualifM3"</span>)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  prof_madre_numeric_nuevos <span class="ot">&lt;-</span> coordenadas_profesiones[<span class="fu">as.factor</span>(nuevos_datos<span class="sc">$</span>Mother.s.occupation), ]</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(prof_madre_numeric_nuevos)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"ProfM1"</span>,<span class="st">"ProfM2"</span>,<span class="st">"ProfM3"</span>)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  prof_padre_numeric_nuevos <span class="ot">&lt;-</span> coordenadas_profesiones[<span class="fu">as.factor</span>(nuevos_datos<span class="sc">$</span> Father.s.occupation), ]</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(prof_padre_numeric_nuevos)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"ProfP1"</span>,<span class="st">"ProfP2"</span>,<span class="st">"ProfP3"</span>)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear el nuevo dataframe numérico</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  datos_numericos_nuevos<span class="ot">&lt;-</span><span class="fu">data.frame</span>(estados_numeric_nuevos,nuevos_datos<span class="sc">$</span>Application.order,grados_numeric_nuevos,nuevos_datos<span class="sc">$</span>Daytime.evening.attendance.,cualif_estudiante_numeric_nuevos,nuevos_datos<span class="sc">$</span>Previous.qualification..grade.,cualif_madre_numeric_nuevos,cualif_padre_numeric_nuevos,prof_madre_numeric_nuevos,prof_padre_numeric_nuevos,nuevos_datos[<span class="dv">13</span><span class="sc">:</span><span class="dv">36</span>])</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(datos_numericos_nuevos) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(nuevos_datos)</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(datos_numericos_nuevos) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(datos_numericos)</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Detectamos los outiers con la función es_outlier y los eliminamos avisando</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  outliers_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">es_outlier</span>(datos_numericos_nuevos, resultado_PCA))</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(outliers_indices) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Se han detectado"</span>, <span class="fu">length</span>(outliers_indices), <span class="st">"outliers. Serán eliminados del conjunto de datos.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>    datos_numericos_nuevos <span class="ot">&lt;-</span> datos_numericos_nuevos[<span class="sc">-</span>outliers_indices, ]</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No se han detectado outliers en los nuevos datos.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(datos_numericos_nuevos)</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Ahora podemos usar esta función para preparar los datos de validación y luego aplicar los modelos que queramos.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar los datos de validación</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>datos_numericos_validation <span class="ot">&lt;-</span> <span class="fu">preparar_datos_para_modelo</span>(validation_data, pca_result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Se han detectado 43 outliers. Serán eliminados del conjunto de datos.</code></pre>
</div>
</div>
<section id="validación-del-modelo-k-means" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="validación-del-modelo-k-means"><span class="header-section-number">4.1</span> Validación del modelo K-means</h2>
<p>Para este modelo vamos a predecir a que cluster de los calculados anteriormente pretenecen los datos en base a la distancia con el centroide de cada cluster.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular distancias a los centroides</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>distancias_centroides <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(<span class="fu">rbind</span>(kmeans_result<span class="sc">$</span>centers, <span class="fu">scale</span>(datos_numericos_validation,<span class="at">center =</span> media_limpios,<span class="at">scale =</span> sd_limpios))))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>distancias_centroides <span class="ot">&lt;-</span> distancias_centroides[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(kmeans_result<span class="sc">$</span>centers)), <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(kmeans_result<span class="sc">$</span>centers)]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar clusters basándose en la distancia mínima</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>predicciones_kmeans <span class="ot">&lt;-</span> <span class="fu">apply</span>(distancias_centroides, <span class="dv">1</span>, which.min)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluar el modelo</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">evaluar_clasificador_binario</span>(</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> predicciones_kmeans,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> validation_data[<span class="fu">rownames</span>(datos_numericos_validation), ]<span class="sc">$</span>Target,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_pred =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_pred =</span> <span class="fu">c</span>(<span class="dv">2</span>),</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_real =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_real =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>)</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$matriz_confusion
          Predicción
Real       Positivo Negativo  Sum
  Positivo      692       60  752
  Negativo      315       22  337
  Sum          1007       82 1089

$metricas
  precision      recall    f1_score    accuracy       error specificity 
  0.6871897   0.9202128   0.7868107   0.6556474   0.3443526   0.0652819 
        npv 
  0.2682927 </code></pre>
</div>
</div>
</section>
<section id="knn-k-nearest-neighbours" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="knn-k-nearest-neighbours"><span class="header-section-number">4.2</span> Knn (K nearest neighbours)</h2>
<p>Seguimos con los K vecinos más cercanos</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>pred_knn <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> datos_scale_limpios,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">cl  =</span> data[<span class="sc">!</span><span class="fu">rownames</span>(data) <span class="sc">%in%</span> IDS_outliers,]<span class="sc">$</span>Target,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">test    =</span> <span class="fu">scale</span>(datos_numericos_validation,<span class="at">center =</span> media_limpios,<span class="at">scale =</span> sd_limpios),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluar_clasificador_binario</span>(</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> pred_knn,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> validation_data[<span class="fu">rownames</span>(datos_numericos_validation), ]<span class="sc">$</span>Target,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_pred =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_pred =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>),</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_real =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_real =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$matriz_confusion
          Predicción
Real       Positivo Negativo  Sum
  Positivo      690       62  752
  Negativo      141      196  337
  Sum           831      258 1089

$metricas
  precision      recall    f1_score    accuracy       error specificity 
  0.8303249   0.9175532   0.8717625   0.8135904   0.1864096   0.5816024 
        npv 
  0.7596899 </code></pre>
</div>
</div>
</section>
<section id="árboles-de-decisión" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="árboles-de-decisión"><span class="header-section-number">4.3</span> Árboles de decisión</h2>
<p>Para este modelo no necesitamos que las variables sean numéricas por lo que las podemos hacer con las originales. De cualquier modo eliminamos los outliers que había.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> data[<span class="fu">setdiff</span>(<span class="fu">rownames</span>(data),IDS_outliers), <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">9</span><span class="sc">:</span><span class="dv">36</span>)]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> data[<span class="fu">setdiff</span>(<span class="fu">rownames</span>(data),IDS_outliers), <span class="st">"Target"</span>]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>X_validation <span class="ot">&lt;-</span> validation_data[<span class="fu">rownames</span>(datos_numericos_validation), <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">9</span><span class="sc">:</span><span class="dv">36</span>)]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>y_validation <span class="ot">&lt;-</span> validation_data[<span class="fu">rownames</span>(datos_numericos_validation), <span class="st">"Target"</span>]</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el árbol de decisión</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>arbol_modelo <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Target <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">data.frame</span>(X_train, <span class="at">Target =</span> y_train), <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecir en los datos de validación</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>pred_arbol <span class="ot">&lt;-</span> <span class="fu">predict</span>(arbol_modelo, <span class="at">newdata =</span> X_validation, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluar el modelo</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluar_clasificador_binario</span>(</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> pred_arbol,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> y_validation,</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_pred =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_pred =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>),</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_real =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_real =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>)</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$matriz_confusion
          Predicción
Real       Positivo Negativo  Sum
  Positivo      668       84  752
  Negativo       87      250  337
  Sum           755      334 1089

$metricas
  precision      recall    f1_score    accuracy       error specificity 
  0.8847682   0.8882979   0.8865295   0.8429752   0.1570248   0.7418398 
        npv 
  0.7485030 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  arbol_modelo,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="dv">2</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">extra =</span> <span class="dv">104</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fallen.leaves =</span> <span class="cn">TRUE</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>El árbol de decisión identifica el número de asignaturas aprobadas en el segundo semestre como el factor determinante del abandono académico. A partir de este umbral, variables administrativas como el pago de tasas y la participación en evaluaciones refinan la clasificación. El identificador del grado (Course), aunque conceptualmente es una variable categórica, es tratado por el árbol como numérica y se utiliza en niveles más profundos para discriminar entre estudiantes que finalmente se gradúan y aquellos que permanecen matriculados. Si bien esta interpretación no es estrictamente correcta desde el punto de vista semántico, su efecto es secundario y no afecta al objetivo principal del estudio, centrado en la identificación temprana de estudiantes con riesgo de abandono.</p>
<p>El modelo clasifica rapidamente a los estudiantes que con bastante seguridad dejen sus estudios (por tener menos de 4 asignaturas aprobadas en el segundo semestre) y a los que con seguridad se gradúen (por tener 6 o más asignaturas aprobadas). El resto de estudiantes son clasificados en función de variables administrativas que pueden ser indicativas de su compromiso académico, como el pago de tasas o la participación en evaluaciones.</p>
</section>
<section id="random-forest" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">4.4</span> Random forest</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el modelo Random Forest. Reutilizamos las variables X_train e y_train definidas anteriormente</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>rf_modelo <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="at">x =</span> X_train, <span class="at">y =</span> <span class="fu">as.factor</span>(y_train), <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecir en los datos de validación</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>pred_rf <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_modelo, <span class="at">newdata =</span> X_validation)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluar el modelo</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluar_clasificador_binario</span>(</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> pred_rf,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> y_validation,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_pred =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_pred =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>),</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_real =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_real =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$matriz_confusion
          Predicción
Real       Positivo Negativo  Sum
  Positivo      701       51  752
  Negativo       97      240  337
  Sum           798      291 1089

$metricas
  precision      recall    f1_score    accuracy       error specificity 
  0.8784461   0.9321809   0.9045161   0.8640955   0.1359045   0.7121662 
        npv 
  0.8247423 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importancia de las variables (seleccionamos las 10 primeras)</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_modelo, <span class="at">type =</span> <span class="dv">2</span>,<span class="at">n.var =</span> <span class="dv">15</span>,<span class="at">main =</span> <span class="st">"Importancia de las Variables en Random Forest"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>El análisis de la importancia de variables en el modelo de random forest confirma que el rendimiento académico es el principal factor explicativo del abandono universitario, destacando especialmente el número de asignaturas aprobadas y las calificaciones obtenidas en el segundo semestre. Variables administrativas como el pago de tasas y la participación en evaluaciones contribuyen de forma complementaria, mientras que características previas del estudiante, como la nota de acceso, la formación anterior o la edad en el momento de matrícula, presentan una influencia significativamente menor. Estos resultados refuerzan la idea de que el riesgo de abandono se manifiesta principalmente a través del desempeño académico durante el primer año.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Análisis del error out-of-bag</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rf_modelo)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"topright"</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">c</span>(</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Error global"</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">levels</span>(<span class="fu">as.factor</span>(y_train))</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span>),</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">bty =</span> <span class="st">"n"</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>El análisis del error out-of-bag del modelo de random forest muestra que el clasificador identifica con alta fiabilidad tanto a los estudiantes que finalmente se gradúan como a aquellos que abandonan los estudios, que constituyen el principal objetivo del análisis. Por el contrario, la clase correspondiente a estudiantes aún matriculados presenta una mayor tasa de error, lo cual es coherente con su carácter intermedio y menos definido. Asimismo, se observa que el error del modelo se estabiliza a partir de aproximadamente 40 árboles, indicando que un mayor número de árboles no aporta mejoras significativas en el rendimiento.</p>
</section>
<section id="conclusiones" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="conclusiones"><span class="header-section-number">4.5</span> Conclusiones</h2>
<p>Comparando los modelos de K-means, KNN, árbol de decisión y random forest, observamos que tanto el árbol de decisión como el random forest ofrecen un rendimiento superior en la clasificación del abandono universitario. El árbol de decisión destaca por su interpretabilidad y rapidez en la identificación de estudiantes en riesgo, basándose principalmente en el rendimiento académico del primer año. Por otro lado, el random forest proporciona una mayor robustez y precisión, aunque a costa de una menor transparencia en la toma de decisiones. Ambos modelos superan significativamente a K-means y KNN, que presentan limitaciones en la captura de las complejas interacciones entre variables. En resumen, para aplicaciones prácticas donde la interpretabilidad es clave, el árbol de decisión es preferible, mientras que para maximizar la precisión predictiva, el random forest es la mejor opción.</p>
</section>
<section id="simplificación-del-modelo-random-forest." class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="simplificación-del-modelo-random-forest."><span class="header-section-number">4.6</span> Simplificación del modelo random forest.</h2>
<p>Vamos a reentrenar el random forest con solo las 11 variables más importantes ya que son las meramente académicas y por tanto más faciles de conseguir por parte de la universidad para ver si el rendimiento no empeora demasiado. Este modelo pretende que no sea necesario disponer de tantos datos para predecir el desempeño de un estudiante.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar las 10 variables más importantes</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>importancia_variables <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">importance</span>(rf_modelo, <span class="at">type =</span> <span class="dv">2</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>top_variables <span class="ot">&lt;-</span> importancia_variables <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MeanDecreaseGini)) <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>top_variables <span class="ot">&lt;-</span> <span class="fu">rownames</span>(top_variables)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reentrenar el modelo Random Forest con las 10 variables más importantes</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>rf_modelo_simplificado <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="at">x =</span> X_train[, top_variables], <span class="at">y =</span> <span class="fu">as.factor</span>(y_train), <span class="at">ntree =</span> <span class="dv">50</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecir en los datos de validación</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>pred_rf_simplificado <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_modelo_simplificado, <span class="at">newdata =</span> X_validation[, top_variables])</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluar el modelo simplificado</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluar_clasificador_binario</span>(</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> pred_rf_simplificado,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">real =</span> y_validation,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_pred =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_pred =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>),</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos_real =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">neg_real =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$matriz_confusion
          Predicción
Real       Positivo Negativo  Sum
  Positivo      700       52  752
  Negativo      100      237  337
  Sum           800      289 1089

$metricas
  precision      recall    f1_score    accuracy       error specificity 
  0.8750000   0.9308511   0.9020619   0.8604224   0.1395776   0.7032641 
        npv 
  0.8200692 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Probamos el modelo a lo bruto con los outliers también</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(validation_data[<span class="fu">setdiff</span>(<span class="fu">rownames</span>(validation_data),<span class="fu">rownames</span>(datos_numericos_validation)),]<span class="sc">$</span>Target)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Dropout Enrolled Graduate 
      20        8       15 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>pred_rf_simplificado_solo_outliers <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_modelo_simplificado, <span class="at">newdata =</span> validation_data[<span class="fu">setdiff</span>(<span class="fu">rownames</span>(validation_data),<span class="fu">rownames</span>(datos_numericos_validation)),top_variables])</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Guardamos el modelo de random forest simplificado para usarlo en la app Shiny</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(rf_modelo_simplificado, <span class="at">file =</span> <span class="st">"rf_modelo_simplificado.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="testing-final" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Testing final</h1>
<p>A continuación se presentan el rendimiento final del modelo de random forest normal y simplificado al aplicarlo a un conjunto de datos de prueba independiente, eliminando los outliers.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar los datos de prueba</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">unlist</span>(top_variables[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">11</span>)])</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>IDS_outliers_test<span class="ot">&lt;-</span><span class="fu">rownames</span>(test_data)[</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowSums</span>(test_data[, cols[<span class="sc">-</span><span class="fu">length</span>(cols)]] <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="fu">length</span>(cols)<span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  test_data[, cols[<span class="fu">length</span>(cols)]] <span class="sc">==</span> <span class="dv">171</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>test_data_limpio <span class="ot">&lt;-</span> test_data[<span class="sc">!</span><span class="fu">rownames</span>(test_data) <span class="sc">%in%</span> IDS_outliers_test, ]</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Probamos el random forest normal y medimos las metricas</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>pred_rf_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_modelo, <span class="at">newdata =</span> test_data_limpio[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">9</span><span class="sc">:</span><span class="dv">36</span>)])</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluar_clasificador_binario</span>(</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred =</span> pred_rf_test,</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">real =</span> test_data_limpio<span class="sc">$</span>Target,</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos_pred =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">neg_pred =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>),</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos_real =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">neg_real =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$matriz_confusion
          Predicción
Real       Positivo Negativo  Sum
  Positivo      702       45  747
  Negativo       81      248  329
  Sum           783      293 1076

$metricas
  precision      recall    f1_score    accuracy       error specificity 
  0.8965517   0.9397590   0.9176471   0.8828996   0.1171004   0.7537994 
        npv 
  0.8464164 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ahora con el random forest simplificado</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>pred_rf_simplificado_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_modelo_simplificado, <span class="at">newdata =</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  test_data_limpio[, top_variables])</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="fu">evaluar_clasificador_binario</span>(</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred =</span> pred_rf_simplificado_test,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">real =</span> test_data_limpio<span class="sc">$</span>Target,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos_pred =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">neg_pred =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>),</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos_real =</span> <span class="fu">c</span>(<span class="st">"Graduate"</span>,<span class="st">"Enrolled"</span>),</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">neg_real =</span> <span class="fu">c</span>(<span class="st">"Dropout"</span>)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$matriz_confusion
          Predicción
Real       Positivo Negativo  Sum
  Positivo      694       53  747
  Negativo       88      241  329
  Sum           782      294 1076

$metricas
  precision      recall    f1_score    accuracy       error specificity 
  0.8874680   0.9290495   0.9077829   0.8689591   0.1310409   0.7325228 
        npv 
  0.8197279 </code></pre>
</div>
</div>
<p>Vemos que los resultados corresponden con lo esperado y el modelo simplificado tiene un rendimiento similar al completo aportando la ventaja de necesitar menos datos para hacer la predicción. y tener menos complejidad. Ambos modelos superan claramente a los modelos de K-means y KNN probados inicialmente con una precisión del 94% y 93% en cada caso y un error del 12% y 13%.</p>
<p>Para mejorar estas métricas sería necesario disponer de más datos de estudiantes y de otras variables que puedan influir en el abandono como por ejemplo datos socioeconómicos o de integración social en la universidad.</p>
<p>En el archivo <a href="formulario.qmd"><code>formulario.qmd</code></a> se presenta una aplicación Shiny que permite introducir los datos de un estudiante y predecir si abandonará o no sus estudios utilizando el modelo de random forest simplificado entrenado en este análisis.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>